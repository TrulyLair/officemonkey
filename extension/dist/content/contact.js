(function() {
function s(t,e=5e3,c=100){return new Promise(n=>{const i=Date.now(),o=()=>{if(t()){n(!0);return}if(Date.now()-i>=e){n(!1);return}setTimeout(o,c)};o()})}function a(t){const e=document.createElement("style");e.textContent=t,document.head.appendChild(e)}function r(t){const e=document.createElement("link");e.rel="stylesheet",e.type="text/css",e.href=t,document.head.appendChild(e)}
const S = a;
function g(t){var n;const e=Array.from(t);e.sort((r,c)=>{var s,d,l,u;const i=((d=(s=r.querySelector(".OneContactNoteDate"))==null?void 0:s.textContent)==null?void 0:d.trim())||"",a=((u=(l=c.querySelector(".OneContactNoteDate"))==null?void 0:l.textContent)==null?void 0:u.trim())||"";return i===a?1:a.localeCompare(i)});const o=(n=e[0])==null?void 0:n.parentNode;o&&e.forEach(r=>{o.appendChild(r)})}function v(t){return t.match(/[a-zA-Z@]/)?"email0email_addr":t.match(/^\.\d+/)?"contact0sub_id":"phone0full_phone"}function E(t,e){return e==="phone0full_phone"||e==="contact0sub_id"?t.replace(/[^0-9]/g,""):t}function b(t,e){const o=E(e,t);return t==="contact0sub_id"?`https://safeoffice.com/SearchContact.php?${new URLSearchParams({Field1:"contact0sub_id",Data1:o,Exact1:"on",bool:"AND",Submitted:"1",SearchType:"ADVANCED",ct:"ALL_CONTACT",bo:"",alfield:t}).toString()}`:`https://safeoffice.com/SearchContact.php?${new URLSearchParams({[t]:o,ChangeEntity:"ALL_CONTACT",Submitted:"1",SearchType:"QUICK",ct:"ALL_CONTACT",bo:"",ho:"",ro:"",fs:"",ma:"",mfc:"",alfield:t}).toString()}`}function L(t){document.querySelectorAll("tr.RowOdd, tr.RowEven").forEach(o=>{const n=o.querySelectorAll("span[id^='Areacode']");Array.from(n).some(c=>{var a;return(((a=c.textContent)==null?void 0:a.replace(/[\/-]/gi,""))||"").endsWith(t)})||o.remove()})}function w(t){const{type:e,date:o,day:n,time:r,duration:c,status:i,extension:a,booked:s}=t;if(i!=="Same Day"&&i!=="Unconfirmed"&&!window.confirm(`Looks like this event isn't in a 'Same Day' or 'Unconfirmed' status - I see ${i}. Want to continue anyway?`))throw new Error("User clicked Cancel on wrong status");if(new Date(`${o} ${r}`)<new Date&&!window.confirm(`Looks like this event is in the past (I see ${o} ${r}). Want to continue anyway?`))throw new Error("User clicked Cancel on past date");const l=e.split(/\s+/)[0],u={Lake:"Lake House, Emeryville",Temescal:"Temescal House, Oakland"},f=`${l} House arrival protocol`,p=a.replace(" Lairette",""),h=s.replace("$","");return[`Appointment with: ${p}<br>
Date: ${n} ${o}<br>
Time: ${r}<br>
Length: ${c} hr<br>
Type of Service: ${e}<br>
Location: ${u[l]||e}<br>
Rate: ${h}<br>
`,f]}function C(t){return(t*.225).toFixed(2)}function k(t){return{email0email_addr:"email address",contact0sub_id:"contact ID",phone0full_phone:"phone number"}[t]||t}S(`
  .hoverHighlight {background-color: yellow; cursor: pointer}
  #topALSearch {position: absolute; background-color: white; border: 2px; padding: 20px; top: 10px; z-index: 10002; display: none}
  #topALSearch input[type='text'] { border: 2px; font-size: 36pt; padding: 20px; }
`);function A(){try{document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{try{m()}catch(t){console.error("OfficeMonkey: Error in contact initialization:",t)}}):m()}catch(t){console.error("OfficeMonkey: Fatal error in contact init:",t)}}function m(){try{if(document.querySelector("#Note_contact"))try{const e=document.querySelectorAll('div[id^="note_"]');e.length>0&&(N(e),T(e))}catch(e){console.error("OfficeMonkey: Error processing notes:",e)}try{x()}catch(e){console.error("OfficeMonkey: Error setting up table hover:",e)}try{R()}catch(e){console.error("OfficeMonkey: Error setting up Gmail integration:",e)}try{D()}catch(e){console.error("OfficeMonkey: Error setting up TopSearch:",e)}try{_()}catch(e){console.error("OfficeMonkey: Error moving new note form:",e)}try{q()}catch(e){console.error("OfficeMonkey: Error showing search details:",e)}try{$()}catch(e){console.error("OfficeMonkey: Error setting up amount calculator:",e)}}catch(t){console.error("OfficeMonkey: Error in performInitialization:",t)}}function N(t){g(t)}function T(t){t.forEach(e=>{const o=e.querySelector(".OneLinerNoteLeft");o&&(o.addEventListener("mouseenter",()=>{o.classList.add("hoverHighlight")}),o.addEventListener("mouseleave",()=>{o.classList.remove("hoverHighlight")}),o.addEventListener("click",()=>{const n=o.querySelector("td:first-of-type a")||o.querySelector("div.OneView a");n&&n.click()}))})}function x(){document.querySelectorAll("tr.RowOdd, tr.RowEven, .OneLinerLeft").forEach(e=>{e.addEventListener("mouseover",()=>{e.classList.add("hoverHighlight")}),e.addEventListener("mouseout",()=>{e.classList.remove("hoverHighlight")}),e.addEventListener("click",()=>{const o=e.querySelector("td:first-of-type a")||e.querySelector("div.OneView a");o&&o.click()})})}function D(){const t=document.createElement("div");t.id="topALSearch";const e=document.createElement("input");e.type="text",t.appendChild(e),document.body.prepend(t),document.addEventListener("keydown",o=>{if(o.code==="Slash"){const n=document.activeElement;if(n&&(n.tagName==="INPUT"||n.tagName==="TEXTAREA"))return;o.preventDefault(),t.style.display="block",e.focus();return}o.code==="Enter"&&document.activeElement===e&&O(e.value)})}function O(t){if(!t)return;const e=v(t),o=b(e,t);window.location.href=o}function _(){const t=document.querySelector("#NewNote_contact"),e=document.querySelector("#Note_contact");t&&e&&e.prepend(t)}function q(){if(window.location.pathname!=="/SearchContact.php")return;const t=new URLSearchParams(window.location.search),e=t.get("alfield");if(!e)return;const o=t.get(e);if(!o)return;e==="phone0full_phone"&&L(o);const n=k(e),r=document.createElement("h3");r.innerHTML=`TopSearch for <b>${n}</b> containing <b><code>"${o}"</code></b>`;const c=document.querySelector("td h2");c&&c.parentElement&&c.parentElement.insertBefore(r,c.nextSibling)}function $(){const t=document.querySelector("#fees_amt_booked input");if(!t)return;const e=document.querySelector("#fees_amt_collected input"),o=document.querySelector("#fees_amt_collected span.Loud");if(!e||!o)return;const n=document.createElement("button");n.type="button",o.style.display="inline",o.appendChild(n);let r=null;n.addEventListener("click",()=>{r!==null&&e&&(e.value=r)}),t.addEventListener("input",c=>{const a=c.target.value;if(!isNaN(Number(a))&&a!==""){const s=parseFloat(a);r=C(s),n.textContent=`Enter ${r}`}else n.textContent="",r=null})}function R(){document.querySelectorAll("div.OneContactEmailAddr a:not(.NoCall a)").forEach(e=>{e.addEventListener("click",async o=>{var r;o.preventDefault(),o.stopPropagation();const n=((r=e.textContent)==null?void 0:r.trim())||"";if(n)try{const c=M();if(!c)return;const[i,a]=w(c);await navigator.clipboard.writeText(i.replace(/<br>/g,`
`)),window.alert("I built and copied the details block for you. Now opening the email so you can paste it in...");const s=encodeURIComponent(a),d=encodeURIComponent(n),l=`http://mail.google.com/a/amys-lair.com/mail?view=cm&su=${s}&to=${d}`;chrome.tabs.create({url:l,active:!0})}catch(c){if(console.error("Error in Gmail integration:",c),c instanceof Error&&c.message.includes("Cancel"))return;window.alert("Error preparing email. Please check the console for details.")}})})}function M(){const t=document.querySelector("#Report table");if(!t)return null;const e=t.querySelector("tr:nth-child(2)");if(!e)return null;const o=Array.from(e.querySelectorAll("td")).map(u=>{var f;return((f=u.textContent)==null?void 0:f.trim())||""});if(o.length<11)return null;const[,n,r,c,i,a,,,s,,d,l]=o;return{type:n||"",date:r||"",day:c||"",time:i||"",duration:a||"",status:s||"",extension:d||"",booked:l||""}}A();

})();