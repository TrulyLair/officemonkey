(function() {
function s(t,e=5e3,c=100){return new Promise(n=>{const i=Date.now(),o=()=>{if(t()){n(!0);return}if(Date.now()-i>=e){n(!1);return}setTimeout(o,c)};o()})}function a(t){const e=document.createElement("style");e.textContent=t,document.head.appendChild(e)}function r(t){const e=document.createElement("link");e.rel="stylesheet",e.type="text/css",e.href=t,document.head.appendChild(e)}
const g = a;
const m = r;
const C = s;
function S(e){const t=["#990000","#FF0000","#CC0000"];return e.color?t.includes(e.color):!1}function D(e){if(S(e))return{...e,className:"hidden"};const t={...e};if(!t.resourceId&&t.title){const r=t.title.split(" ");r.length>0&&(t.resourceId=r[0].toLowerCase(),t.title=r.slice(1).join(" "))}return t.color&&(t.borderColor=t.color,delete t.color),t.overlap=!1,t.className?typeof t.className=="string"?t.className=[t.className,"width49pc"]:t.className=[...t.className,"width49pc"]:t.className=["width49pc"],t}function v(){const e=document.querySelector("#oldView h2");if(!e)return null;const r=(e.textContent||"").match(/(\d{4}-\d{2}-\d{2})/);return r?r[1]:null}function j(){return[{id:"lake",title:"Lake House"},{id:"temescal",title:"Temescal House"}]}function b(e){const t=[];if(e.tipTitle&&t.push(`<h3>${e.tipTitle}</h3>`),e.tipText&&t.push(`<p>${e.tipText}</p>`),e.start){const i=(typeof e.start=="string"?new Date(e.start):e.start).toLocaleString("en-US",{year:"numeric",month:"2-digit",day:"2-digit",hour:"numeric",minute:"2-digit",hour12:!0});t.push(`<p><b>Start:</b> ${i}</p>`)}if(e.end){const i=(typeof e.end=="string"?new Date(e.end):e.end).toLocaleString("en-US",{year:"numeric",month:"2-digit",day:"2-digit",hour:"numeric",minute:"2-digit",hour12:!0});t.push(`<p><b>End:</b> ${i}</p>`)}return t.join("")}g(`
  .width49pc { width: 49% }
  .left50pc { left: 50% }
`);m("https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.10.0/fullcalendar.css");m("https://cdnjs.cloudflare.com/ajax/libs/fullcalendar-scheduler/1.9.4/scheduler.css");let f=null;async function M(){try{if(!await C(()=>typeof window.$<"u"&&typeof window.$j<"u",1e4)){console.error("OfficeMonkey: jQuery not available after timeout");return}if(document.readyState==="loading")document.addEventListener("DOMContentLoaded",()=>{try{document.querySelector("#calendar")&&document.querySelector("#graphicalView")&&p()}catch(t){console.error("OfficeMonkey: Error in calendar initialization:",t)}});else try{document.querySelector("#calendar")&&document.querySelector("#graphicalView")&&p()}catch(t){console.error("OfficeMonkey: Error in calendar initialization:",t)}}catch(e){console.error("OfficeMonkey: Fatal error in calendar init:",e)}}function p(){try{if(!window.jQuery&&!window.$){console.error("OfficeMonkey: jQuery not available");return}const e=(window.jQuery||window.$).noConflict(!0);window.$y=e,f=E(e),q(e,f)}catch(e){console.error("OfficeMonkey: Error in performCalendarScript:",e)}}function E(e){return window.$j&&typeof window.$j.fn.qtip<"u"?window.$j("<div/>").qtip({id:"calendar",prerender:!0,content:{text:" ",title:{button:!0}},position:{my:"bottom center",at:"top center",target:"event",viewport:window.$j("#calendar"),adjust:{}},show:{delay:500},hide:{delay:500,event:"click mouseleave"},style:"qtip-light qtip-shadow"}).qtip("api"):{hide:()=>{},show:()=>{},set:()=>({show:()=>{}})}}function q(e,t){const r=document.querySelector("#calendar"),i=document.querySelector("#graphicalView");if(r&&r.remove(),i){i.className="";const c=document.createElement("div");c.id="calendar",i.appendChild(c)}const s=new Map,h=v()||new Date().toISOString().split("T")[0];chrome.storage.local.get(["ApptCal_useView","ApptCal_defaultDate"],c=>{try{const u=c.ApptCal_useView||"agendaDay",w=c.ApptCal_defaultDate||h;if(typeof e.fn.fullCalendar>"u"){console.error("OfficeMonkey: FullCalendar not loaded");return}e("#calendar").fullCalendar({header:{left:"prev,next today",center:"title",right:"month,agendaWeek,agendaDay"},titleFormat:"dddd D MMMM YYYY",themeSystem:"jquery-ui",defaultDate:w,defaultView:u,slotEventOverlap:!1,nowIndicator:!0,minTime:"09:00:00",maxTime:"20:00:00",editable:!1,selectable:!0,selectHelper:!0,select:function(n,o,l,a){if(t.hide(),a.name==="month")e("#calendar").fullCalendar("changeView","agendaDay"),e("#calendar").fullCalendar("gotoDate",n);else{const d=!n.hasTime(),y=n.format();window.location.href=`AddAppt.php?ttab=AP&btab=3&dt=${y}&allDay=${d}`}},viewRender:function(n,o){t.hide(),chrome.storage.local.set({ApptCal_useView:n.name});const a=e("#calendar").fullCalendar("getDate").format("YYYY-MM-DD");chrome.storage.local.set({ApptCal_defaultDate:a})},eventMouseout:function(n,o,l){t.hide()},eventMouseover:function(n,o,l){const a=b(n);t.set({"content.text":a}).show(o)},eventDataTransform:function(n){return D(n)||n},eventAfterRender:function(n,o,l){!n.isBuffer&&!o[0].classList.contains("hidden")&&o[0].href&&s.set(o[0].href,o[0])},eventAfterAllRender:function(n){document.querySelectorAll(".bufferEvent").forEach(l=>{const a=l.getAttribute("href");if(a&&s.has(a)){const d=s.get(a);d&&(l.style.left=d.style.left)}})},eventSources:[{url:"json/schedule/calendar.php",error:function(){const n=document.querySelector("#ScheduleOverviewTile");n&&(n.innerHTML="<p>Unable to get Appointments.</p>")}}],resources:j(),schedulerLicenseKey:"GPL-My-Project-Is-Open-Source"})}catch(u){console.error("OfficeMonkey: Error initializing FullCalendar:",u)}})}M().catch(console.error);

})();